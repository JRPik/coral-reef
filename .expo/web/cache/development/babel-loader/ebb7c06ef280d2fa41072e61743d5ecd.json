{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { UnavailabilityError } from 'expo-modules-core';\nimport { CameraType, PermissionStatus } from \"./Camera.types\";\nimport { canGetUserMedia, isBackCameraAvailableAsync, isFrontCameraAvailableAsync } from \"./WebUserMediaManager\";\n\nfunction getUserMedia(constraints) {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  }\n\n  var getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || function () {\n    var error = new Error('Permission unimplemented');\n    error.code = 0;\n    error.name = 'NotAllowedError';\n    throw error;\n  };\n\n  return new Promise(function (resolve, reject) {\n    getUserMedia.call(navigator, constraints, resolve, reject);\n  });\n}\n\nfunction handleGetUserMediaError(_ref) {\n  var message = _ref.message;\n\n  if (message === 'Permission dismissed') {\n    return {\n      status: PermissionStatus.UNDETERMINED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: false\n    };\n  } else {\n    return {\n      status: PermissionStatus.DENIED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: false\n    };\n  }\n}\n\nfunction handleRequestPermissionsAsync() {\n  var message;\n  return _regeneratorRuntime.async(function handleRequestPermissionsAsync$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return _regeneratorRuntime.awrap(getUserMedia({\n            video: true\n          }));\n\n        case 3:\n          return _context.abrupt(\"return\", {\n            status: PermissionStatus.GRANTED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: true\n          });\n\n        case 6:\n          _context.prev = 6;\n          _context.t0 = _context[\"catch\"](0);\n          message = _context.t0.message;\n          return _context.abrupt(\"return\", handleGetUserMediaError({\n            message: message\n          }));\n\n        case 10:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[0, 6]], Promise);\n}\n\nfunction handlePermissionsQueryAsync(query) {\n  var _navigator, _navigator$permission;\n\n  var _await$navigator$perm, state;\n\n  return _regeneratorRuntime.async(function handlePermissionsQueryAsync$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          if ((_navigator = navigator) != null && (_navigator$permission = _navigator.permissions) != null && _navigator$permission.query) {\n            _context2.next = 2;\n            break;\n          }\n\n          throw new UnavailabilityError('expo-camera', 'navigator.permissions API is not available');\n\n        case 2:\n          _context2.next = 4;\n          return _regeneratorRuntime.awrap(navigator.permissions.query({\n            name: query\n          }));\n\n        case 4:\n          _await$navigator$perm = _context2.sent;\n          state = _await$navigator$perm.state;\n          _context2.t0 = state;\n          _context2.next = _context2.t0 === 'prompt' ? 9 : _context2.t0 === 'granted' ? 10 : _context2.t0 === 'denied' ? 11 : 12;\n          break;\n\n        case 9:\n          return _context2.abrupt(\"return\", {\n            status: PermissionStatus.UNDETERMINED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false\n          });\n\n        case 10:\n          return _context2.abrupt(\"return\", {\n            status: PermissionStatus.GRANTED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: true\n          });\n\n        case 11:\n          return _context2.abrupt(\"return\", {\n            status: PermissionStatus.DENIED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false\n          });\n\n        case 12:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nexport default {\n  get name() {\n    return 'ExponentCameraManager';\n  },\n\n  get Type() {\n    return {\n      back: 'back',\n      front: 'front'\n    };\n  },\n\n  get FlashMode() {\n    return {\n      on: 'on',\n      off: 'off',\n      auto: 'auto',\n      torch: 'torch'\n    };\n  },\n\n  get AutoFocus() {\n    return {\n      on: 'on',\n      off: 'off',\n      auto: 'auto',\n      singleShot: 'singleShot'\n    };\n  },\n\n  get WhiteBalance() {\n    return {\n      auto: 'auto',\n      continuous: 'continuous',\n      manual: 'manual'\n    };\n  },\n\n  get VideoQuality() {\n    return {};\n  },\n\n  get VideoStabilization() {\n    return {};\n  },\n\n  isAvailableAsync: function isAvailableAsync() {\n    return function _callee() {\n      return _regeneratorRuntime.async(function _callee$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              return _context3.abrupt(\"return\", canGetUserMedia());\n\n            case 1:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  takePicture: function takePicture(options, camera) {\n    return function _callee2() {\n      return _regeneratorRuntime.async(function _callee2$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return _regeneratorRuntime.awrap(camera.takePicture(options));\n\n            case 2:\n              return _context4.abrupt(\"return\", _context4.sent);\n\n            case 3:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  pausePreview: function pausePreview(camera) {\n    return function _callee3() {\n      return _regeneratorRuntime.async(function _callee3$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return _regeneratorRuntime.awrap(camera.pausePreview());\n\n            case 2:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  resumePreview: function resumePreview(camera) {\n    return function _callee4() {\n      return _regeneratorRuntime.async(function _callee4$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return _regeneratorRuntime.awrap(camera.resumePreview());\n\n            case 2:\n              return _context6.abrupt(\"return\", _context6.sent);\n\n            case 3:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  getAvailableCameraTypesAsync: function getAvailableCameraTypesAsync() {\n    return function _callee5() {\n      var devices, types;\n      return _regeneratorRuntime.async(function _callee5$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              if (!(!canGetUserMedia() || !navigator.mediaDevices.enumerateDevices)) {\n                _context7.next = 2;\n                break;\n              }\n\n              return _context7.abrupt(\"return\", []);\n\n            case 2:\n              _context7.next = 4;\n              return _regeneratorRuntime.awrap(navigator.mediaDevices.enumerateDevices());\n\n            case 4:\n              devices = _context7.sent;\n              _context7.t0 = _regeneratorRuntime;\n              _context7.t1 = Promise;\n              _context7.next = 9;\n              return _regeneratorRuntime.awrap(isFrontCameraAvailableAsync(devices));\n\n            case 9:\n              _context7.t2 = _context7.sent;\n\n              if (!_context7.t2) {\n                _context7.next = 12;\n                break;\n              }\n\n              _context7.t2 = CameraType.front;\n\n            case 12:\n              _context7.t3 = _context7.t2;\n              _context7.next = 15;\n              return _regeneratorRuntime.awrap(isBackCameraAvailableAsync());\n\n            case 15:\n              _context7.t4 = _context7.sent;\n\n              if (!_context7.t4) {\n                _context7.next = 18;\n                break;\n              }\n\n              _context7.t4 = CameraType.back;\n\n            case 18:\n              _context7.t5 = _context7.t4;\n              _context7.t6 = [_context7.t3, _context7.t5];\n              _context7.t7 = _context7.t1.all.call(_context7.t1, _context7.t6);\n              _context7.next = 23;\n              return _context7.t0.awrap.call(_context7.t0, _context7.t7);\n\n            case 23:\n              types = _context7.sent;\n              return _context7.abrupt(\"return\", types.filter(Boolean));\n\n            case 25:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  getAvailablePictureSizes: function getAvailablePictureSizes(ratio, camera) {\n    return function _callee6() {\n      return _regeneratorRuntime.async(function _callee6$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              _context8.next = 2;\n              return _regeneratorRuntime.awrap(camera.getAvailablePictureSizes(ratio));\n\n            case 2:\n              return _context8.abrupt(\"return\", _context8.sent);\n\n            case 3:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  getPermissionsAsync: function getPermissionsAsync() {\n    return function _callee7() {\n      return _regeneratorRuntime.async(function _callee7$(_context9) {\n        while (1) {\n          switch (_context9.prev = _context9.next) {\n            case 0:\n              return _context9.abrupt(\"return\", handlePermissionsQueryAsync('camera'));\n\n            case 1:\n            case \"end\":\n              return _context9.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  requestPermissionsAsync: function requestPermissionsAsync() {\n    return function _callee8() {\n      return _regeneratorRuntime.async(function _callee8$(_context10) {\n        while (1) {\n          switch (_context10.prev = _context10.next) {\n            case 0:\n              return _context10.abrupt(\"return\", handleRequestPermissionsAsync());\n\n            case 1:\n            case \"end\":\n              return _context10.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  getCameraPermissionsAsync: function getCameraPermissionsAsync() {\n    return function _callee9() {\n      return _regeneratorRuntime.async(function _callee9$(_context11) {\n        while (1) {\n          switch (_context11.prev = _context11.next) {\n            case 0:\n              return _context11.abrupt(\"return\", handlePermissionsQueryAsync('camera'));\n\n            case 1:\n            case \"end\":\n              return _context11.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  requestCameraPermissionsAsync: function requestCameraPermissionsAsync() {\n    return function _callee10() {\n      return _regeneratorRuntime.async(function _callee10$(_context12) {\n        while (1) {\n          switch (_context12.prev = _context12.next) {\n            case 0:\n              return _context12.abrupt(\"return\", handleRequestPermissionsAsync());\n\n            case 1:\n            case \"end\":\n              return _context12.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  getMicrophonePermissionsAsync: function getMicrophonePermissionsAsync() {\n    return function _callee11() {\n      return _regeneratorRuntime.async(function _callee11$(_context13) {\n        while (1) {\n          switch (_context13.prev = _context13.next) {\n            case 0:\n              return _context13.abrupt(\"return\", handlePermissionsQueryAsync('microphone'));\n\n            case 1:\n            case \"end\":\n              return _context13.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  requestMicrophonePermissionsAsync: function requestMicrophonePermissionsAsync() {\n    return function _callee12() {\n      var message;\n      return _regeneratorRuntime.async(function _callee12$(_context14) {\n        while (1) {\n          switch (_context14.prev = _context14.next) {\n            case 0:\n              _context14.prev = 0;\n              _context14.next = 3;\n              return _regeneratorRuntime.awrap(getUserMedia({\n                audio: true\n              }));\n\n            case 3:\n              return _context14.abrupt(\"return\", {\n                status: PermissionStatus.GRANTED,\n                expires: 'never',\n                canAskAgain: true,\n                granted: true\n              });\n\n            case 6:\n              _context14.prev = 6;\n              _context14.t0 = _context14[\"catch\"](0);\n              message = _context14.t0.message;\n              return _context14.abrupt(\"return\", handleGetUserMediaError({\n                message: message\n              }));\n\n            case 10:\n            case \"end\":\n              return _context14.stop();\n          }\n        }\n      }, null, null, [[0, 6]], Promise);\n    }();\n  }\n};","map":{"version":3,"sources":["../src/ExponentCameraManager.web.ts"],"names":[],"mappings":"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","sourcesContent":["import { UnavailabilityError } from 'expo-modules-core';\n\nimport {\n  CameraCapturedPicture,\n  CameraPictureOptions,\n  CameraType,\n  PermissionResponse,\n  PermissionStatus,\n} from './Camera.types';\nimport { ExponentCameraRef } from './ExponentCamera.web';\nimport {\n  canGetUserMedia,\n  isBackCameraAvailableAsync,\n  isFrontCameraAvailableAsync,\n} from './WebUserMediaManager';\n\nfunction getUserMedia(constraints: MediaStreamConstraints): Promise<MediaStream> {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  }\n\n  // Some browsers partially implement mediaDevices. We can't just assign an object\n  // with getUserMedia as it would overwrite existing properties.\n  // Here, we will just add the getUserMedia property if it's missing.\n\n  // First get ahold of the legacy getUserMedia, if present\n  const getUserMedia =\n    // TODO: this method is deprecated, migrate to https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n    navigator.getUserMedia ||\n    navigator.webkitGetUserMedia ||\n    navigator.mozGetUserMedia ||\n    function () {\n      const error: any = new Error('Permission unimplemented');\n      error.code = 0;\n      error.name = 'NotAllowedError';\n      throw error;\n    };\n\n  return new Promise((resolve, reject) => {\n    getUserMedia.call(navigator, constraints, resolve, reject);\n  });\n}\n\nfunction handleGetUserMediaError({ message }: { message: string }): PermissionResponse {\n  // name: NotAllowedError\n  // code: 0\n  if (message === 'Permission dismissed') {\n    return {\n      status: PermissionStatus.UNDETERMINED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: false,\n    };\n  } else {\n    // TODO: Bacon: [OSX] The system could deny access to chrome.\n    // TODO: Bacon: add: { status: 'unimplemented' }\n    return {\n      status: PermissionStatus.DENIED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: false,\n    };\n  }\n}\n\nasync function handleRequestPermissionsAsync(): Promise<PermissionResponse> {\n  try {\n    await getUserMedia({\n      video: true,\n    });\n    return {\n      status: PermissionStatus.GRANTED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: true,\n    };\n  } catch ({ message }) {\n    return handleGetUserMediaError({ message });\n  }\n}\n\nasync function handlePermissionsQueryAsync(\n  query: 'camera' | 'microphone'\n): Promise<PermissionResponse> {\n  if (!navigator?.permissions?.query) {\n    throw new UnavailabilityError('expo-camera', 'navigator.permissions API is not available');\n  }\n\n  const { state } = await navigator.permissions.query({ name: query });\n  switch (state) {\n    case 'prompt':\n      return {\n        status: PermissionStatus.UNDETERMINED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n    case 'granted':\n      return {\n        status: PermissionStatus.GRANTED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: true,\n      };\n    case 'denied':\n      return {\n        status: PermissionStatus.DENIED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n  }\n}\n\nexport default {\n  get name(): string {\n    return 'ExponentCameraManager';\n  },\n  get Type() {\n    return {\n      back: 'back',\n      front: 'front',\n    };\n  },\n  get FlashMode() {\n    return {\n      on: 'on',\n      off: 'off',\n      auto: 'auto',\n      torch: 'torch',\n    };\n  },\n  get AutoFocus() {\n    return {\n      on: 'on',\n      off: 'off',\n      auto: 'auto',\n      singleShot: 'singleShot',\n    };\n  },\n  get WhiteBalance() {\n    return {\n      auto: 'auto',\n      continuous: 'continuous',\n      manual: 'manual',\n    };\n  },\n  get VideoQuality() {\n    return {};\n  },\n  get VideoStabilization() {\n    return {};\n  },\n  async isAvailableAsync(): Promise<boolean> {\n    return canGetUserMedia();\n  },\n  async takePicture(\n    options: CameraPictureOptions,\n    camera: ExponentCameraRef\n  ): Promise<CameraCapturedPicture> {\n    return await camera.takePicture(options);\n  },\n  async pausePreview(camera: ExponentCameraRef): Promise<void> {\n    await camera.pausePreview();\n  },\n  async resumePreview(camera: ExponentCameraRef): Promise<void> {\n    return await camera.resumePreview();\n  },\n  async getAvailableCameraTypesAsync(): Promise<string[]> {\n    if (!canGetUserMedia() || !navigator.mediaDevices.enumerateDevices) return [];\n\n    const devices = await navigator.mediaDevices.enumerateDevices();\n\n    const types: (string | null)[] = await Promise.all([\n      (await isFrontCameraAvailableAsync(devices)) && CameraType.front,\n      (await isBackCameraAvailableAsync()) && CameraType.back,\n    ]);\n\n    return types.filter(Boolean) as string[];\n  },\n  async getAvailablePictureSizes(ratio: string, camera: ExponentCameraRef): Promise<string[]> {\n    return await camera.getAvailablePictureSizes(ratio);\n  },\n  /* async getSupportedRatios(camera: ExponentCameraRef): Promise<string[]> {\n    // TODO: Support on web\n  },\n  async record(\n    options?: CameraRecordingOptions,\n    camera: ExponentCameraRef\n  ): Promise<{ uri: string }> {\n    // TODO: Support on web\n  },\n  async stopRecording(camera: ExponentCameraRef): Promise<void> {\n    // TODO: Support on web\n  }, */\n  async getPermissionsAsync(): Promise<PermissionResponse> {\n    return handlePermissionsQueryAsync('camera');\n  },\n  async requestPermissionsAsync(): Promise<PermissionResponse> {\n    return handleRequestPermissionsAsync();\n  },\n  async getCameraPermissionsAsync(): Promise<PermissionResponse> {\n    return handlePermissionsQueryAsync('camera');\n  },\n  async requestCameraPermissionsAsync(): Promise<PermissionResponse> {\n    return handleRequestPermissionsAsync();\n  },\n  async getMicrophonePermissionsAsync(): Promise<PermissionResponse> {\n    return handlePermissionsQueryAsync('microphone');\n  },\n  async requestMicrophonePermissionsAsync(): Promise<PermissionResponse> {\n    try {\n      await getUserMedia({\n        audio: true,\n      });\n      return {\n        status: PermissionStatus.GRANTED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: true,\n      };\n    } catch ({ message }) {\n      return handleGetUserMediaError({ message });\n    }\n  },\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}